{% extends 'base.html' %}
{% import "_macros.html" as macros %}

{% block title %}评论{% endblock %}

{% block page_content %}
    {% include '_posts.html' %}
    <div class="made-comment made-cp">
        <form method="post" class="form {{ current_user.wow_faction_en() }}" role="form">
            {{ form.hidden_tag() }}
            <div class="form-group">
                {{ form.body(class="form-control", placeholder='我的议论...', required=True) }}
            </div>
            <div class="form-group">
                {{ form.submit(class="choose", disabled='disabled') }}
            </div>
        </form>
    </div>
    {% if comments %}{% include '_comments.html' %}{% endif %}
    {% if pagination.pages > 1 %}
        <div class="container my-pagination">
            {{ macros.pagination_widget(pagination, '.post', id=posts[0].id) }}
            <form method="post" class="form" role="form">
                {{ form_jump.hidden_tag() }}
            <div class="form-group">{{ form_jump.page_num(class="page-num " + current_user.wow_faction_en()) }}{{ form_jump.submit(class="jump " + current_user.wow_faction_en(), disabled='disabled') }}</div>
            </form>
        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    {{ pagedown.include_pagedown() }}
    <script type="text/javascript">
        $(function () {
            if ('{{ confirmed }}' === '') {
                $('.form-control').attr('placeholder', '请验证账户之后再发布议论。');
                $('.form-control').attr('disabled', 'disabled');
            }
            $('.form-control').bind('input propertychange', function() {
                var val = $(this).val();
                if (/^\s*$/.test(val)) {
                    $('.choose').attr('disabled', 'disabled').removeClass('active');
                } else {
                    $('.choose').removeAttr('disabled').addClass('active');
                }
            }).focus(function () {
                $(this).attr('placeholder', '');
            }).focusout(function () {
                $(this).attr('placeholder', '我的议论...');
            });
        })
    </script>
    <script id="jump" src="{{ url_for('static', filename='jump.js') }}" onload="jump({{ pages }})" arg="{{ current_user.wow_faction_color() }}"></script>
{% endblock %}